#include <stdio.h>

int global_var;
int global_initialized_var = 5;

void function() { // This is just a demo function.
  int stack_var; // Notice this variable has the same name as the one in main().

  printf("the function's stack_var is at address 0x%08x\n", &stack_var);
}

// gcc -g memory_segments.c -o memory_segments.out
int main() {
  int stack_var; // Same name as the variable in function().
  static int static_initialized_var = 5;
  static int static_var;
  int *heap_var_ptr;

  // Since the newly allocated memory could be of any data type,
  // the malloc() function returns a void pointer,
  // which needs to be typecast into an integer pointer
  heap_var_ptr = (int *) malloc(4);

  // These variables are in the data segment.
  printf("global_initialized_var is at address 0x%08x\n", &global_initialized_var);
  printf("static_initialized_var is at address 0x%08x\n\n", &static_initialized_var);

  // These variables are in the bss segment.
  printf("static_var is at address 0x%08x\n", &static_var);
  printf("global_var is at address 0x%08x\n\n", &global_var);

  // This variable is in the heap segment.
  printf("heap_var is at address 0x%08x\n\n", heap_var_ptr);

  // These variables are in the stack segment.
  printf("stack_var is at address 0x%08x\n", &stack_var);
  function();
}

/*

- In C, as in other compiled languages, the compiled code goes into the text segment,
  while the variables reside in the remaining segments.
  Exactly which memory segment a variable will be stored in depends on how the variable is defined.
- Variables that are defined outside of any functions are considered to be global.
  The static keyword can also be prepended to any variable declaration to make the variable static.
- If static or global variables are initialized with data, they are stored in the data memory segment;
  otherwise, these variables are put in the bss memory segment.
- Since data and bss memory segments have a fixed size after compilation,
  there is little wasted space, and the addresses aren't very far apart
- Memory on the heap memory segment must first be allocated using a memory allocation function called malloc().
  Usually, pointers are used to reference memory on the heap.
- Tthe remaining function variables are stored in the stack memory segment.
  Since the stack can contain many different stack frames,
  stack variables can maintain uniqueness within different functional contexts.
- Since the stack grows back up toward the heap segment with each new stack frame,
  the memory address for the second stack_var (0xffeddb98) is smaller than the address
  for the first stack_var (0xffeddbb4) found within main()'s context

OUTPUT

global_initialized_var is at address 0x5663a008
static_initialized_var is at address 0x5663a00c

static_var is at address 0x5663a014
global_var is at address 0x5663a018

heap_var is at address 0x58046160

stack_var is at address 0xffeddbb4
the function's stack_var is at address 0xffeddb98

*/
