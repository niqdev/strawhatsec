<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-notes/hacking-the-art-of-exploitation">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<title data-rh="true">Hacking: The Art of Exploitation | StrawHatSec</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://niqdev.github.io/strawhatsec/docs/notes/hacking-the-art-of-exploitation"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Hacking: The Art of Exploitation | StrawHatSec"><meta data-rh="true" name="description" content="The goal of this book is to share the art of hacking with everyone"><meta data-rh="true" property="og:description" content="The goal of this book is to share the art of hacking with everyone"><link data-rh="true" rel="icon" href="/strawhatsec/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://niqdev.github.io/strawhatsec/docs/notes/hacking-the-art-of-exploitation"><link data-rh="true" rel="alternate" href="https://niqdev.github.io/strawhatsec/docs/notes/hacking-the-art-of-exploitation" hreflang="en"><link data-rh="true" rel="alternate" href="https://niqdev.github.io/strawhatsec/docs/notes/hacking-the-art-of-exploitation" hreflang="x-default"><link rel="stylesheet" href="/strawhatsec/assets/css/styles.ac76d216.css">
<link rel="preload" href="/strawhatsec/assets/js/runtime~main.a1f67934.js" as="script">
<link rel="preload" href="/strawhatsec/assets/js/main.0263cb78.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/strawhatsec/docs/home"><div class="navbar__logo"><img src="/strawhatsec/img/hat.png" alt="StrawHatSec Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/strawhatsec/img/hat.png" alt="StrawHatSec Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">StrawHatSec</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/niqdev/strawhatsec" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/strawhatsec/docs/home">Home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/strawhatsec/docs/resources/cryptography">Resources</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/strawhatsec/docs/notes/binary-exploitation-memory-corruption">Notes</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/strawhatsec/docs/notes/binary-exploitation-memory-corruption">Binary Exploitation / Memory Corruption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/strawhatsec/docs/notes/the-art-of-petwork-penetration-testing">The Art of Network Penetration Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/strawhatsec/docs/notes/the-shellcoder-s-handbook">The Shellcoder&#x27;s Handbook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/strawhatsec/docs/notes/hacking-the-art-of-exploitation">Hacking: The Art of Exploitation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/strawhatsec/docs/htb/todo">HTB</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/strawhatsec/docs/docker/setup">Docker Images</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/strawhatsec/docs/contribute">How to contribute</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/strawhatsec/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Notes</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Hacking: The Art of Exploitation</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Hacking: The Art of Exploitation</h1><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>About</div><div class="admonitionContent_S0QG"><p>The goal of this book is to share the art of hacking with everyone</p><p><a href="https://nostarch.com/hacking2.htm" target="_blank" rel="noopener noreferrer">Hacking: The Art of Exploitation (2008)(2nd)</a></p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="chapter-0x200">Chapter 0x200<a class="hash-link" href="#chapter-0x200" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="notes">Notes<a class="hash-link" href="#notes" title="Direct link to heading">​</a></h3><p>Hacking is really just the act of finding a clever and counterintuitive solution to a problem</p><ul><li><em>Machine language</em> consists of raw bits and bytes, and it differs from architecture to architecture</li><li>An <em>assembler</em> is one form of machine-language translator: it is a program that translates architecture specific <em>assembly language</em> into machine-readable code</li><li>A <em>compiler</em> converts a high-level language into machine language</li><li>A program written in a high-level language is written once, and the same piece of program code can be compiled into machine language for various specific architectures</li><li>The <em>GNU Compiler Collection</em> (GCC) is a free C compiler which outputs executable binary files</li><li>C code is meant to be compiled. The code can&#x27;t actually do anything until it&#x27;s compiled into an executable binary file</li><li><code>objdump</code>, included in the GNU development tools, can be used to examine compiled binaries</li><li>Each byte is represented in <em>hexadecimal notation</em>, which is a base-16 numbering system. This is a convenient notation since a byte contains 8 bits, each of which can be either true or false. This means a byte has 256 (2^8) possible values, so each byte can be described with 2 hexadecimal digits</li><li>The bits of the machine language instructions must be put somewhere, and this somewhere is called <em>memory</em>. Memory is just a
collection of bytes of temporary storage space that are numbered with addresses</li><li>Memory can be thought of as a row of bytes, each with its own memory address. Each byte of memory can be accessed by its address, and in this case the CPU accesses this part of memory to retrieve the machine language instructions that make up the compiled program</li><li>Older Intel x86 processors use a 32-bit addressing scheme, while newer ones use a 64-bit one. The 32-bit processors have 2^32 (or 4,294,967,296) possible addresses, while the 64-bit ones have 2^64 (1.84467441 × 10^19) possible addresses. The 64-bit processors can run in 32-bit compatibility mode</li><li>Assembly language is really just a collection of mnemonics for the corresponding machine language instructions</li><li>Unlike C and other compiled languages, assembly language instructions have a direct one-to-one relationship with their corresponding machine language instructions. This means that since every processor architecture has different machine language instructions, each processor also has a different form of assembly language. Assembly is just a way for programmers to represent the machine language instructions that are given to the processor: there are 2 main types, AT&amp;T syntax and Intel syntax</li><li>These instructions consist of an operation and sometimes additional arguments that describe the destination and/or the source for the operation. These operations move memory around, perform some sort of basic math, or interrupt the processor to get it to do something else. In the end, that’s all a computer processor can really do!</li><li>Processors also have their own set of special variables called <em>registers</em></li><li>The 8086 CPU was the first x86 processor, amd it was developed and manufactured by Intel</li><li>The GNU development tools also include a <em>debugger</em> called GDB. Debuggers are used by programmers to step through compiled programs, examine program memory, and view processor registers.</li><li>GDB is used to show the state of the processor registers right before the program starts</li><li><em>General-purpose</em> registers:<ul><li>Accumulator <code>EAX</code></li><li>Counter <code>ECX</code></li><li>Data <code>EDX</code></li><li>Base <code>EBX</code></li><li>They are used for a variety of purposes, but they mainly act as temporary variables for the CPU when it is executing machine instructions</li></ul></li><li><em>Pointers</em> registers:<ul><li>Stack Pointer <code>ESP</code></li><li>Base Pointer <code>EBP</code></li><li>They are called pointers because they store 32-bit addresses, which essentially point to that location in memory</li></ul></li><li><em>Indexes</em> registers:<ul><li>Source Index <code>ESI</code></li><li>Destination Index <code>EDI</code></li><li>They are also technically pointers, which are commonly used to point to the source and destination when data needs to be read from or written to</li></ul></li><li><em>Instruction Pointer</em> register <code>EIP</code> points to the current instruction the processor is reading during a programs execution by containing its memory address</li><li><em>Extended Flags</em> register <code>EFLAGS</code> consists of several bit flags that are used for comparisons and memory segmentations. The actual memory is split into several different segments, and these registers keep track of that</li><li>Assembly instructions in Intel syntax<ul><li>generally follow this style: <code>operation &lt;destination&gt;, &lt;source&gt;</code></li><li>destination and source values will either be a register, a memory address, or a value</li></ul></li><li>The instructions before the <code>main</code> entrypoint are collectively known as the <em>function prologue</em> and are generated by the compiler to set up memory for the rest of the main() function&#x27;s local variables. Part of the reason variables need to be declared in C is to aid the construction of this section of code. The debugger knows this part of the code is automatically generated and is smart enough to skip over it</li><li>The <code>x</code> examine command in GDB can be used to look at a certain address of memory<ul><li>This command expects two arguments when it&#x27;s used: the location in memory to examine and how to display that memory</li><li>The display format also uses a single-letter shorthand, which is optionally preceded by a count of how many items to examine<ul><li><code>o</code> Display in octal</li><li><code>x</code> Display in hexadecimal</li><li><code>u</code> Display in unsigned, standard base-10 decimal</li><li><code>t</code> Display in binary</li><li><code>c</code> Look up a byte on the ASCII table</li><li><code>s</code> Display in string</li></ul></li><li>The default size of a single unit is a four-byte unit called a <em>word</em>. The size of the display units for the examine command can be changed by adding a size letter to the end of the format letter<ul><li><code>b</code> A single byte</li><li><code>h</code> A halfword, which is two bytes in size</li><li><code>w</code> A word, which is four bytes in size. In this case a double word or <em>DWORD</em> refers to a 4-byte value</li><li><code>g</code> A giant, which is eight bytes in size</li></ul></li><li>The examine command also accepts the format letter <code>i</code>, short for instruction, to display the memory as disassembled assembly language instructions</li></ul></li><li>x86 processor values are stored in <em>little-endian byte order</em>, which means the least significant byte is stored first. For example, if four bytes are to be interpreted as a single value, the bytes must be used in reverse order</li><li>The <code>bt</code> command can be used to <em>backtrace</em> the stack</li><li>All numerical values are stored in binary<ul><li>a 32-bit unsigned integer can contain values from 0 (all binary 0s) to (2^32 -1) 4,294,967,295 (all binary 1s)</li><li>a 32-bit signed integer range from (-2^31) −2,147,483,648 to (2^31 -1) 2,147,483,647. Essentially, one of the bits is a flag marking the value positive or negative</li><li>positively signed values look the same as unsigned values, but negative numbers are stored differently using a method called <em>two&#x27;s complement</em></li><li>the backtrace shows the nested function calls by looking at records kept on the stack. Each time a function is called, a record called a <em>stack frame</em> is put on the stack. Each line in the backtrace corresponds to a stack frame. Each stack frame also contains the local variables for that context</li></ul></li><li>To see the actual data stored in a pointer variable, you can use the unary operator <code>&amp;</code> ampersand called <em>address-of</em> operator</li><li>To see the data found in the address the pointer is pointing to, instead of the address itself, you can use the unary operator <code>*</code> asterisk called <em>dereference</em></li><li><em>Typecasting</em> is simply a way to temporarily change a variable&#x27;s data type, despite how it was originally defined</li><li>Memory is split into <em>segments</em>, and some memory addresses aren&#x27;t within the boundaries of the memory segments the program is given access to. When the program attempts to access an address that is out of bounds, it will crash and die in what&#x27;s called a <em>segmentation fault</em></li><li>A compiled program&#x27;s memory is divided into five segments: text, data, bss, heap, and stack</li><li>The <em>text segment</em> is also sometimes called the <em>code segment</em> and it&#x27;s where the assembled machine language instructions of the program are located<ul><li>as a program executes, the EIP is set to the first instruction in the text segment, the processor then follows an execution loop that does the following:<ol><li>reads the instruction that EIP is pointing to</li><li>adds the byte length of the instruction to EIP</li><li>executes the instruction that was read in step 1</li><li>goes back to step 1</li></ol></li><li>sometimes the instruction will be a jump or a call instruction, which changes the EIP to a different address of memory. The processor doesn&#x27;t care about the change, because it&#x27;s expecting the execution to be nonlinear anyway</li><li>write permission is disabled in the text segment, as it is not used to store variables, only code. It can be shared among different copies of the program, allowing multiple executions of the program at the same time without any problems. This memory segment has a fixed size, since nothing ever changes in it</li></ul></li><li>The data and bss segments are used to store global and static program variables<ul><li>the <em>data segment</em> is filled with the initialized global and static variables</li><li>the <em>bss segment</em> is filled with their uninitialized counterparts</li><li>although these segments are writable, they have a fixed size</li></ul></li><li>The <em>heap segment</em> is a segment of memory a programmer can directly control and use for whatever might need, memory can be reserved and free on the fly<ul><li>the heap segment isn&#x27;t of fixed size, so it can grow larger or smaller as needed</li><li>the growth of the heap moves downward toward higher memory addresses</li><li>the heap will grow and shrink depending on how much memory is reserved for use</li><li>all of the memory within the heap is managed by allocator and deallocator algorithms, which respectively reserve a region of memory in the heap for use and remove reservations to allow that portion of memory to be reused for later reservations</li></ul></li><li>The <em>stack segment</em> also has variable size and is used as a temporary scratch pad to store local function variables and context during function calls<ul><li>this is what GDB&#x27;s backtrace <code>bt</code> command looks at</li><li>when a program calls a function, that function will have its own set of passed variables, and the function&#x27;s code will be at a different memory location in the text (or code) segment. Since the context and the EIP must change when a function is called, the stack is used to remember all of the passed variables, the location the EIP should return to after the function is finished, and all the local variables used by that function. All of this information is stored together on the stack in what is collectively called a <em>stack frame</em>. The stack contains many stack frames</li><li>a stack is an abstract data structure, it has first-in, last-out (FILO) ordering, which means the first item that is put into a stack is the last item to come out of it</li><li>when an item is placed into a stack, it&#x27;s known as <em>pushing</em>, and when an item is removed from a stack, it&#x27;s called <em>popping</em></li><li>the stack segment of memory is, in fact, a stack data structure, which contains stack frames</li><li>the <code>ESP</code> register is used to keep track of the address of the end of the stack, which is constantly changing as items are pushed into and popped off of it</li><li>the stack is also not of a fixed size. Opposite to the dynamic growth of the heap, as the stack changes in size, it grows upward in a visual listing of memory, toward lower memory addresses</li><li>the FILO nature of a stack might seem odd, but since the stack is used to store context, it&#x27;s very useful</li><li>when a function is called, several things are pushed to the stack together in a stack frame<ul><li>the <code>EBP</code> register, sometimes called the <em>frame pointer</em> (FP) or <em>local base</em> (LB) pointer, is used to reference local function variables in the current stack frame</li><li>each stack frame contains the parameters to the function, its local variables, and two pointers that are necessary to put things back the way they were: the <em>saved frame pointer</em> (SFP) and the <em>return address</em></li><li>the SFP is used to restore EBP to its previous value, and the return address is used to restore EIP to the next instruction found after the function call. This restores the functional context of the previous stack frame</li></ul></li></ul></li><li>The first few instructions of each function set up the stack frame. These instructions are collectively called the <em>procedure prologue</em> or <em>function prologue</em>. They save the frame pointer on the stack, and they save stack memory for the local function variables. Sometimes the function prologue will handle some stack alignment as well. The exact prologue instructions will vary greatly depending on the compiler and compiler options, but in general these instructions build the stack frame</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># x86 (32 bits) + remove ASLR warning</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run --rm -it </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name ubuntu </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cap-add</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">SYS_PTRACE </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --security-opt </span><span class="token assign-left variable" style="color:#36acaa">seccomp</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">unconfined </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable builtin class-name" style="color:#36acaa">pwd</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c">/notes/hacking-the-art-of-exploitation:/share&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --platform linux/386 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  i386/ubuntu:18.04 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># install C compiler and debugger</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> gcc gdb -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /share/chapter02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc firstprog.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># default binary file name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./a.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objdump -D a.out </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -A20 main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objdump -D a.out -M intel </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -A20 main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># &lt;ADDRESS&gt; &lt;MACHINE_LANGUAGE_INSTRUCTION&gt; &lt;ASSEMBLY_LANGUAGE_INSTRUCTION&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Little-endian explained</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gdb -q ./a.out </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gdb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin class-name">break</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gdb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gdb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> x/4xb </span><span class="token variable" style="color:#36acaa">$eip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x5655e53a </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">main+2</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:   0xc7    0x45    0xf4    0x00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gdb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> x/4ub </span><span class="token variable" style="color:#36acaa">$eip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x5655e53a </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">main+2</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:   </span><span class="token number" style="color:#36acaa">199</span><span class="token plain">     </span><span class="token number" style="color:#36acaa">69</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">244</span><span class="token plain">     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gdb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> x/1xw </span><span class="token variable" style="color:#36acaa">$eip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x5655e53a </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">main+2</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:   0x00f445c7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gdb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> x/1uw </span><span class="token variable" style="color:#36acaa">$eip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x5655e53a </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">main+2</span><span class="token operator file-descriptor important" style="color:#393A34">9</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:   </span><span class="token number" style="color:#36acaa">16008647</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">bc</span><span class="token plain"> -ql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">199</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">256</span><span class="token plain">^3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">+69*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">256</span><span class="token plain">^2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">+244*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">256</span><span class="token plain">^1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">+0*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">256</span><span class="token plain">^0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">3343250432</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">0</span><span class="token plain">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">256</span><span class="token plain">^3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">+244*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">256</span><span class="token plain">^2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">+69*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">256</span><span class="token plain">^1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">+199*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">256</span><span class="token plain">^0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">16008647</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># the seven bytes EIP is pointing to actually are machine language</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># for the corresponding assembly instruction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objdump -D a.out -M intel </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -A20 main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 53a:   c7 </span><span class="token number" style="color:#36acaa">45</span><span class="token plain"> f4 00 00 00 00    mov    DWORD PTR </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ebp-0xc</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,0x0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Remove modern protections</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># includes symbols: -g</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># to build 32-bit code on a 64-bit machine: -m32</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># disable canary: -fno-stack-protector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># disable DEP: -z execstack</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># to have the compiler generate asm that doesn&#x27;t bother with PIE stuff: -fno-pie</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># disable PIE to have it not link that machine code into a PIE: -no-pie</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc -g -m32 -fno-stack-protector -z execstack -fno-pie -no-pie firstprog.c -o firstprog.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># disable ASLR in host (outside docker)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sysctl -n kernel.randomize_va_space</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sysctl -w kernel.randomize_va_space</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># debugger</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gdb -q ./firstprog.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) set disassembly intel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) list</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) disassemble main</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) break main</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) run</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) info registers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) info registers eip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) i r eip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) x/o 0x565dc53a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) x/x $eip   </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) x/u $eip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) x/t $eip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) x/10x $eip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) x/8xb $eip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) x/8xh $eip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) x/8xw $eip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) x/i $eip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) x/3i $eip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) print $ebp - 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) x/6cb &lt;ADDRESS&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) x/s &lt;ADDRESS&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) print &amp;pointer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) print *pointer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) nexti</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#(gdb) quit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># use it as hexadecimal calculator</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gdb -q --batch -ex </span><span class="token string" style="color:#e3116c">&quot;p 0xbb - 0xaa&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># default config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;set disassembly intel&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ~/.gdbinit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ASCII table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">man</span><span class="token plain"> ascii</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Analysis</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">                       ┌────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       │ 440            ◄──┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────────────────┐     │ 448 PUTS       │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 437 SET 0      │     │ 450 INC 1      │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 43e JMP to 454 ├─────► 454 CMP == 9   │  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────┘     │ 458 JLE 440    ├──┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       └───────┬────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            ┌──▼──┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            │ 45a │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            └─────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Dump of assembler code for function main:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048426 &lt;+0&gt;:     lea    ecx,[esp+0x4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0804842a &lt;+4&gt;:     and    esp,0xfffffff0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0804842d &lt;+7&gt;:     push   DWORD PTR [ecx-0x4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048430 &lt;+10&gt;:    push   ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048431 &lt;+11&gt;:    mov    ebp,esp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048433 &lt;+13&gt;:    push   ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048434 &lt;+14&gt;:    sub    esp,0x14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   # MAIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048437 &lt;+17&gt;:    mov    DWORD PTR [ebp-0xc],0x0      ; 437 SET 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0804843e &lt;+24&gt;:    jmp    0x8048454 &lt;main+46&gt;          ; 43e JMP to 454 (#1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   # LOOP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048440 &lt;+26&gt;:    sub    esp,0xc                      ; 440 (#2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048443 &lt;+29&gt;:    push   0x80484f0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048448 &lt;+34&gt;:    call   0x80482e0 &lt;puts@plt&gt;         ; 448 PUTS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0804844d &lt;+39&gt;:    add    esp,0x10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048450 &lt;+42&gt;:    add    DWORD PTR [ebp-0xc],0x1      ; 450 INC 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048454 &lt;+46&gt;:    cmp    DWORD PTR [ebp-0xc],0x9      ; 454 CMP == 9 (#1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048458 &lt;+50&gt;:    jle    0x8048440 &lt;main+26&gt;          ; 458 JLE to 440 (#2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   # EXIT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0804845a &lt;+52&gt;:    mov    eax,0x0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0804845f &lt;+57&gt;:    mov    ecx,DWORD PTR [ebp-0x4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048462 &lt;+60&gt;:    leave  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048463 &lt;+61&gt;:    lea    esp,[ecx-0x4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x08048466 &lt;+64&gt;:    ret    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End of assembler dump.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Other examples</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># char_array</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># datatype_sizes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># pointer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># addressof</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># fmt_strings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># input</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># typecasting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># pointer_types</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># commandline</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># convert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># scope</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># static</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># stack_example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># memory_segments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># heap_example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># errorchecked_heap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># simplenote</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># bitwise</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># fcntl_flags</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># uid_demo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># notetaker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># notesearch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># time_example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># funcptr_example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># rand_example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># game_of_chance (from sources)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc -g -m32 -fno-stack-protector -z execstack -fno-pie -no-pie </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">PROGRAM</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">.c -o </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">PROGRAM</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gdb -q ./</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">PROGRAM</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">.out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="memory-segmentation!" src="/strawhatsec/assets/images/memory-segmentation-f4c6d3596df446d5b0c7d6981d5df173.png" title="memory-segmentation" width="513" height="506" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="resources">Resources<a class="hash-link" href="#resources" title="Direct link to heading">​</a></h3><ul><li><a href="https://github.com/vapier/pcalc" target="_blank" rel="noopener noreferrer">pcalc</a></li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/vapier/pcalc.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> pcalc/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> bison flex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pcalc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extra">Extra<a class="hash-link" href="#extra" title="Direct link to heading">​</a></h3><ul><li><a href="https://tyeyeah.github.io/2020/01/23/2020-01-23-Security-Protection-Mechanism" target="_blank" rel="noopener noreferrer">Security Protection Mechanism</a></li><li><a href="https://www.sans.org/blog/stack-canaries-gingerly-sidestepping-the-cage" target="_blank" rel="noopener noreferrer">Stack Canaries</a> to prevent <code>stack smashing detected</code></li><li><a href="https://stackoverflow.com/a/40867982" target="_blank" rel="noopener noreferrer">How to turn off gcc compiler optimization to enable buffer overflow</a></li><li><a href="https://stackoverflow.com/questions/2463150/what-is-the-fpie-option-for-position-independent-executables-in-gcc-and-ld" target="_blank" rel="noopener noreferrer">What is the -fPIE option for position-independent executables in gcc?</a> about <code>PIE</code> and <code>ASLR</code></li><li><a href="https://stackoverflow.com/questions/35860527/warning-error-disabling-address-space-randomization-operation-not-permitted" target="_blank" rel="noopener noreferrer">Error disabling address space randomization: Operation not permitted</a></li><li><a href="https://visualgdb.com/gdbreference/commands/set_disable-randomization" target="_blank" rel="noopener noreferrer">set disable-randomization command</a></li><li><a href="https://www.cs.cornell.edu/~tomf/notes/cps104/twoscomp.html" target="_blank" rel="noopener noreferrer">Two&#x27;s Complement</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="chapter-0x300">Chapter 0x300<a class="hash-link" href="#chapter-0x300" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="notes-1">Notes<a class="hash-link" href="#notes-1" title="Direct link to heading">​</a></h3><ul><li>Exploiting a program is simply a clever way of getting the computer to do what you want it to do, even if the currently running program was designed to prevent that action. A program can only do what it&#x27;s programmed to do, to the letter of the law. Unfortunately, what&#x27;s written doesn&#x27;t always coincide with what the programmer intended the program to do.</li><li>Off-by-one errors and improper Unicode expansion are all mistakes that can be hard to see at the time but are glaringly obvious to any programmer in
hindsight</li><li><em>Buffer Overrun</em> or <em>Buffer Overflow</em></li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /share/chapter03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># overflow_example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># exploit_notesearch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># auth_overflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># getenv_example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># getenvaddr</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># fmt_uncommon</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># fmt_vuln</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># dtors_sample</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># exploit_notetaker.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># exploit_game_of_chance.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># exploit_global_offset_table.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Generate payloads</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># perl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">perl -e </span><span class="token string" style="color:#e3116c">&#x27;print &quot;A&quot; x 27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">perl -e </span><span class="token string" style="color:#e3116c">&#x27;print &quot;\x41&quot; x 20;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">perl -e </span><span class="token string" style="color:#e3116c">&#x27;print &quot;A&quot;x20 . &quot;BCD&quot; . &quot;\x61\x66\x67\x69&quot;x2 . &quot;Z&quot;;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># little endian: de|ad|be|ef</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">perl -e </span><span class="token string" style="color:#e3116c">&#x27;print &quot;A&quot;x16 . &quot;\xef\xbe\xad\xde&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">perl -e </span><span class="token variable string" style="color:#e3116c">&#x27;print &quot;uname&quot;;&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">una</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">perl -e </span><span class="token variable string" style="color:#e3116c">&#x27;print &quot;m&quot;;&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">u</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">perl -e </span><span class="token variable string" style="color:#e3116c">&#x27;print &quot;na&quot;;&#x27;</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain">me</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">u</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">perl -e </span><span class="token variable string" style="color:#e3116c">&#x27;print &quot;na&quot;;&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">me</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">perl -e </span><span class="token string" style="color:#e3116c">&#x27;print crypt(&quot;password&quot;, &quot;salt&quot;). &quot;\n&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># python</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python -c </span><span class="token string" style="color:#e3116c">&#x27;print &quot;A&quot;*27&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python -c </span><span class="token string" style="color:#e3116c">&#x27;import sys; sys.stdout.write(&quot;A&quot;*27 + &quot;\x90&quot;*4)&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">i</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">..</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hello&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">i</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">seq</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable number" style="color:#36acaa">0</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable number" style="color:#36acaa">30</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable number" style="color:#36acaa">300</span><span class="token variable" style="color:#36acaa">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hello-</span><span class="token string variable" style="color:#36acaa">$i</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Others</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># list symbols</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nm </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">BINARY</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extra-1">Extra<a class="hash-link" href="#extra-1" title="Direct link to heading">​</a></h3><ul><li><a href="https://www.gdbgui.com" target="_blank" rel="noopener noreferrer">gdbgui</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="chapter-0x400">Chapter 0x400<a class="hash-link" href="#chapter-0x400" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="notes-2">Notes<a class="hash-link" href="#notes-2" title="Direct link to heading">​</a></h3><ul><li>The seven OSI layers are as follows:<ul><li>The <strong>Physical layer</strong> deals with the physical connection between two points. This is the lowest layer, whose primary role is communicating raw bit streams. This layer is also responsible for activating, maintaining, and deactivating these bit-stream communications <em>e.g. Ethernet Cable and Card</em></li><li>The <strong>Data-link layer</strong> deals with actually transferring data between two points. In contrast with the physical layer, which takes care of sending the raw bits, this layer provides high-level functions, such as error correction and flow control. This layer also provides procedures for activating, maintaining, and deactivating data-link connections <em>e.g. Ethernet</em><ul><li>Every Ethernet device is assigned a globally unique address consisting of six bytes, usually written in hexadecimal in the form <code>xx:xx:xx:xx:xx:xx</code>, known as Media Access Control (MAC) addresses</li><li>An Ethernet header is 14 bytes in size and contains the source and destination MAC addresses for this Ethernet packet</li><li>Ethernet addressing also provides a special broadcast address, consisting of all binary 1&#x27;s <code>ff:ff:ff:ff:ff:ff</code></li><li>The MAC address of a network device isn&#x27;t meant to change, but its IP address may change regularly. The concept of IP addresses doesn&#x27;t exist at this level, only hardware addresses do. To correlate the two addressing schemes, the Address Resolution Protocol (ARP) is used. There are four different types of ARP messages, but the two most important types are <em>ARP request messages</em> and <em>ARP reply messages</em></li></ul></li><li>The <strong>Network layer</strong> works as a middle ground; its primary role is to pass information between the lower and the higher layers. It provides addressing and routing <em>e.g. IP address and router</em></li><li>The <strong>Transport layer</strong> provides transparent transfer of data between systems. By providing reliable data communication, this layer allows the higher layers to never worry about reliability or cost-effectiveness of data transmission e.g. <em>TCP</em></li><li>The <strong>Session layer</strong> is responsible for establishing and maintaining connections between network applications</li><li>The <strong>Presentation layer</strong> is responsible for presenting the data to applications in a syntax or language they understand. This allows for things like encryption and data compression</li><li>The <strong>Application layer</strong> is concerned with keeping track of the requirements of the application <em>e.g. HTTP, SMTP, IMAP, FTP</em></li></ul></li><li>When data is communicated through these protocol layers, it&#x27;s sent in small pieces called packets. Each packet contains implementations of these protocol layers and wraps the previous layer. This process is called encapsulation. Each wrapped layer contains a header and a body. The header contains the protocol information needed for that layer, while the body contains the data for that layer. The body of one layer contains the entire package of previously
encapsulated layers.</li><li>A socket is a standard way to perform network communication through the OS. A socket can be thought of as an endpoint to a connection, but they are just a programmer&#x27;s abstraction that takes care of all the nitty-gritty details of the OSI model. To the programmer, a socket can be used to send or receive data over a network at the session layer. The most common types are stream sockets (Transmission Control Protocol) and datagram sockets (User Datagram Protocol)</li><li>In C, sockets behave a lot like files since they use file descriptors to identify themselves. The port number and IP address used in the AF_INET socket address structure are expected to follow the network byte ordering, which is big-endian. This is the opposite of x86&#x27;s little-endian byte ordering</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /share/chapter04</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># simple_server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># host_lookup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># webserver_id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># tinyweb</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># raw_tcpsniff</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># pcap_sniff</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># decode_sniff</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># synflood</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># rst_hijack</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Sources</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/include/i386-linux-gnu/sys/socket.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/include/i386-linux-gnu/bits/socket.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/include/i386-linux-gnu/bits/socket_type.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/include/netinet/in.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/include/arpa/inet.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/include/netdb.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/include/linux/if_ether.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/include/netinet/ip.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/include/netinet/tcp.h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Network Sniffing</p><ul><li>On an <em>unswitched network</em>, Ethernet packets pass through every device on the network, expecting each system device to only look at the packets sent to its destination address</li><li>If a device is set to <em>promiscuous mode</em>, it looks at all packets, regardless of the destination address</li><li>In a <em>switched network</em> environment, packets are only sent to the port they are destined for, according to their destination MAC addresses, so promiscuous devices aren&#x27;t able to sniff any additional packets</li><li>The act of forging a source address in a packet is known as <em>spoofing</em></li><li>ARP cache poisoning<ul><li>when an ARP reply comes in with an IP address that already exists in the ARP cache, the receiving system will overwrite the prior MAC address information with the new information found in the reply</li><li>no state information about the ARP traffic is kept: systems will accept an ARP reply even if they didn&#x27;t send out an ARP request</li><li>the attacker sends spoofed ARP replies to certain devices that cause the ARP cache entries to be overwritten with the attacker&#x27;s data</li><li>due to timeout values, the victim machines will periodically send out real ARP requests and receive real ARP replies in response. In order to maintain the redirection attack, the attacker must keep the victim machine&#x27;s ARP caches poisoned</li></ul></li><li>A <em>gateway</em> is a system that routes all the traffic from a local network out to the Internet</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># enable promiscuous mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ifconfig</span><span class="token plain"> eth0 promisc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> tcpdump -l -X </span><span class="token string" style="color:#e3116c">&#x27;ip host &lt;IP_ADDRESS&gt;&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Denial of Service (most of the attacks are obsolete)</p><ul><li>A DoS attack simply prevents access to a service or resource. There are two general forms of attacks: those that crash services and those that flood services</li><li>A <em>SYN flood</em> tries to exhaust states in the TCP/IP stack: the kernel has a finite table that can only track so many incoming connections<ul><li>a technique called syncookies to try to prevent SYN flood attack: the TCP connections don&#x27;t actually become active until the final ACK packet for the TCP handshake is checked</li></ul></li><li>The <em>Ping of Death</em>: ICMP echo messages can only have 2^16, or 65.536, bytes of data in the data part of the packet. Several operating systems crashed if they were sent ICMP echo messages that exceeded the size specified. See also <em>Bluesmack</em> for Bluetooth</li><li><em>Teardrop</em> exploited IP fragmentation reassembly</li><li><em>Ping/UDP Flooding</em> also <ul><li>an attacker with greater bandwidth than a victim can send more data than the victim can receive and therefore deny other legitimate traffic from getting to the victim</li><li>an <em>amplification attack</em> uses spoofing and broadcast addressing to amplify a single stream of packets by a hundred-fold: also known as <em>smurf</em> and <em>fraggle</em> attacks</li></ul></li><li>In a DDoS attack, the attacker first compromises a number of other hosts and installs daemons on them. Systems installed with such software are commonly referred to as bots and make up what is known as a botnet</li></ul><p>TCP/IP hijacking</p><ul><li>TCP/IP hijacking is a clever technique that uses spoofed packets to take over a connection between a victim and a host machine</li><li>RST Hijacking involves injecting an authentic-looking reset (RST) packet. If the source is spoofed and the acknowledgment number is correct, the receiving side will believe that the source actually sent the reset packet, and the connection will be reset<ul><li>libpcap provides a way to tell the kernel to only send certain packets that match a filter. This filter, known as a Berkeley Packet Filter (BPF), is very similar to a program</li></ul></li></ul><p>Port Scanning</p><ul><li>Port scanning is a way of figuring out which ports are listening and accepting connections<ul><li>the simplest form of port scanning involves trying to open TCP connections to every possible port on the target system: it&#x27;s noisy and detectable</li></ul></li><li>A <em>SYN scan</em> <code>nmap -sS</code> is also sometimes called a half-open scan<ul><li>The TCP/IP handshake: when a full connection is made, first a SYN packet is sent, then a SYN/ACK packet is sent back, and finally an ACK packet is returned to complete the handshake and open the connection</li><li>A SYN scan doesn&#x27;t complete the handshake, so a full connection is never opened</li><li>If a SYN/ACK packet is received in response, that port must be accepting connections. This is recorded, and an RST packet is sent to tear down the connection</li></ul></li><li><em>FIN</em> <code>nmap -sF</code>, <em>X-mas</em> <code>nmap -sX</code>, and <em>Null scans</em> <code>nmap -sN</code> techniques involve sending a nonsensical packet to every port on the target system: if a port is listening, these packets just get ignored. However, if the port is closed and the implementation follows protocol (RFC 793), an RST packet will be sent. This difference can be used to detect which ports are accepting connections, without actually opening any connections<ul><li>FIN scan sends a FIN packet</li><li>X-mas scan sends a packet with FIN, URG, and PUSH turned on</li><li>Null scan sends a packet with no TCP flags set</li><li>they are stealthier, but they can also be unreliable: Microsoft&#x27;s implementation of TCP doesn&#x27;t send RST packets</li></ul></li><li><em>Spoofing Decoys</em> <code>nmap -D</code> to avoid detection. This technique simply spoofs connections from various decoy real IP addresses of live hosts in between each real port-scanning connection</li><li><em>Idle scanning</em> <code>nmap -sI</code> is a way to scan a target using spoofed packets from an idle host, by observing changes in the idle host that is not sending or receiving any other network traffic and that has a TCP implementation that produces predictable IP IDs that change by a known increment with each packet. IP IDs are meant to be unique per packet per session</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="resources-1">Resources<a class="hash-link" href="#resources-1" title="Direct link to heading">​</a></h3><ul><li><a href="https://datatracker.ietf.org/doc/html/rfc826" target="_blank" rel="noopener noreferrer">RFC 826</a>: Address Resolution Protocol</li><li><a href="https://datatracker.ietf.org/doc/html/rfc791" target="_blank" rel="noopener noreferrer">RFC 791</a>: Internet Protocol</li><li><a href="https://datatracker.ietf.org/doc/html/rfc793" target="_blank" rel="noopener noreferrer">RFC 793</a>: Transmission Control Protocol</li><li><a href="https://datatracker.ietf.org/doc/html/rfc768" target="_blank" rel="noopener noreferrer">RFC 768</a>: User Datagram Protocol</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extra-2">Extra<a class="hash-link" href="#extra-2" title="Direct link to heading">​</a></h3><ul><li><a href="https://hpd.gasmi.net" target="_blank" rel="noopener noreferrer">Hex Packet Decoder</a></li><li><a href="https://www.wireshark.org" target="_blank" rel="noopener noreferrer">Wireshark</a></li><li><a href="https://www.kismetwireless.net" target="_blank" rel="noopener noreferrer">Kismet</a></li><li><a href="https://www.ettercap-project.org" target="_blank" rel="noopener noreferrer">Ettercap</a></li><li><a href="https://scapy.net" target="_blank" rel="noopener noreferrer">Scapy</a></li><li><a href="https://0xbharath.github.io/art-of-packet-crafting-with-scapy" target="_blank" rel="noopener noreferrer">The Art of Packet Crafting with Scapy</a></li><li><a href="https://www.tcpdump.org" target="_blank" rel="noopener noreferrer">tcpdump</a></li><li><a href="https://www.monkey.org/~dugsong/dsniff" target="_blank" rel="noopener noreferrer">dsniff</a></li><li><a href="https://www.devdungeon.com/content/using-libpcap-c" target="_blank" rel="noopener noreferrer">Using libpcap in C</a></li><li><a href="https://github.com/libnet/nemesis" target="_blank" rel="noopener noreferrer">nemesis</a></li><li><a href="https://github.com/nmap/nmap" target="_blank" rel="noopener noreferrer">nmap</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="chapter-0x500">Chapter 0x500<a class="hash-link" href="#chapter-0x500" title="Direct link to heading">​</a></h2><p>TODO review</p><ul><li><code>exploit_notesearch</code> implementation pag 136-150</li><li><code>tinyweb_exploit</code> implementation pag 272-280</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> /share/chapter05</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># helloworld</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Install man pages</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> man-db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># extra</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-cache</span><span class="token plain"> search manpages </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">egrep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;manpages-(dev|posix)&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># fix &quot;See &#x27;man 7 undocumented&#x27;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">yes</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> unminimize</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Every possible Linux system call is enumerated, so they can be referenced by numbers when making the calls in assembly, See <code>/usr/include/???/unistd.h</code></li><li>The <code>mov</code> instruction copies a value between its two operands. Using Intel assembly syntax, the first operand is the destination and the second is the source</li><li>The <code>int</code> instruction sends an interrupt signal to the kernel, defined by its single operand. With the Linux kernel, interrupt <code>0x80</code> is used to tell the kernel to make a system call. When the <code>int 0x80</code> instruction is executed, the kernel will make a system call based on the first four registers. The <code>EAX</code> register is used to specify which system call to make, while the <code>EBX</code>, <code>ECX</code>, and <code>EDX</code> registers are used to hold the first, second, and third arguments to the system call. All of these registers can be set using the mov instruction</li><li>To create an executable <em>ELF</em> binary, the assembly code must first be assembled and then linked into an executable format</li><li>The <code>nasm</code> assembler with the <code>-f elf</code> argument will assemble the <code>*.asm</code> into an object file ready to be linked as an ELF binary</li><li>The linker program <code>ld</code> will produce an executable <code>*.out</code> binary from the assembled object</li><li>In shellcode<ul><li>instructions must be self-contained and ready to take over control of the processor regardless of its current state</li><li>the bytes for a string must be mixed together with the bytes for the assembly instructions, since there aren&#x27;t definable or predictable memory segments</li><li>to access the string as data we need a pointer to it. When the shellcode gets executed, it could be anywhere in memory. The string&#x27;s absolute memory address needs to be calculated relative to EIP</li></ul></li><li>Stack-based exploits are made possible by the <code>call</code> and <code>ret</code> instructions. When a function is called, the return address of the next instruction is pushed to the stack, beginning the stack frame. After the function is finished, the ret instruction pops the return address from the stack and jumps EIP back there. By overwriting the stored return address on the stack before the ret instruction, we can take control of a program&#x27;s execution</li><li>The <code>nasm</code> assembler converts assembly language into machine code and a corresponding tool called <code>ndisasm</code> converts machine code into assembly</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> nasm -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># install hexdump</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> bsdmainutils -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># assemble (elf|elf64)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nasm -f elf helloworld.asm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># link</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ld -m elf_i386 helloworld.o -o helloworld.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># run</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./helloworld.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># hexadecimal view</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hexdump -C helloworld_nosegment.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># disassemble</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ndisasm -b32 helloworld_nosegment.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objdump -D -M intel helloworld.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">readelf -a helloworld.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">strings helloworld.out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># helloworld</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># helloworld_nosegment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># helloworld_nonull</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># exploit_helloworld.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extra-3">Extra<a class="hash-link" href="#extra-3" title="Direct link to heading">​</a></h3><ul><li><a href="https://www.nasm.us" target="_blank" rel="noopener noreferrer">NASM</a></li><li><a href="https://www.kernel.org" target="_blank" rel="noopener noreferrer">The Linux Kernel Archives</a></li><li><a href="https://linux-kernel-labs.github.io" target="_blank" rel="noopener noreferrer">The Linux Kernel Labs</a></li><li><a href="https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64" target="_blank" rel="noopener noreferrer">Linux System Call Table for x86/64</a></li><li><a href="https://stackoverflow.com/questions/38751614/what-are-the-return-values-of-system-calls-in-assembly" target="_blank" rel="noopener noreferrer">What are the return values of system calls in Assembly?</a></li><li>ITSC 3181 - Lecture 2 <a href="https://passlab.github.io/ITSC3181/notes/lecture02_CompilationAssemblingLinkingProgramExecution.pdf" target="_blank" rel="noopener noreferrer">Compilation, Assembling, Linking and Program Execution</a></li><li><a href="https://axcheron.github.io/linux-shellcode-101-from-hell-to-shell" target="_blank" rel="noopener noreferrer">Linux Shellcode 101: From Hell to Shell</a></li></ul><blockquote><p>TODO pag 295</p></blockquote></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/strawhatsec/docs/notes/the-shellcoder-s-handbook"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">The Shellcoder&#x27;s Handbook</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/strawhatsec/docs/htb/todo"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">TODO</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#chapter-0x200" class="table-of-contents__link toc-highlight">Chapter 0x200</a><ul><li><a href="#notes" class="table-of-contents__link toc-highlight">Notes</a></li><li><a href="#resources" class="table-of-contents__link toc-highlight">Resources</a></li><li><a href="#extra" class="table-of-contents__link toc-highlight">Extra</a></li></ul></li><li><a href="#chapter-0x300" class="table-of-contents__link toc-highlight">Chapter 0x300</a><ul><li><a href="#notes-1" class="table-of-contents__link toc-highlight">Notes</a></li><li><a href="#extra-1" class="table-of-contents__link toc-highlight">Extra</a></li></ul></li><li><a href="#chapter-0x400" class="table-of-contents__link toc-highlight">Chapter 0x400</a><ul><li><a href="#notes-2" class="table-of-contents__link toc-highlight">Notes</a></li><li><a href="#resources-1" class="table-of-contents__link toc-highlight">Resources</a></li><li><a href="#extra-2" class="table-of-contents__link toc-highlight">Extra</a></li></ul></li><li><a href="#chapter-0x500" class="table-of-contents__link toc-highlight">Chapter 0x500</a><ul><li><a href="#extra-3" class="table-of-contents__link toc-highlight">Extra</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/strawhatsec/docs/contribute">Contribute</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 niqdev</div></div></div></footer></div>
<script src="/strawhatsec/assets/js/runtime~main.a1f67934.js"></script>
<script src="/strawhatsec/assets/js/main.0263cb78.js"></script>
</body>
</html>